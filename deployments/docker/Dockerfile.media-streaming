# Dockerfile for media-streaming, using the common go-builder.
# syntax=docker/dockerfile:1.4
# --- Build Stage ---
# Use the common builder stage which contains all source code and dependencies.
FROM ovasabi-go-builder:latest AS builder

# The working directory is /app, inherited from the builder.
# All source code is present, and protoc has been run.

# Build the media-streaming binary.
RUN CGO_ENABLED=0 GOOS=linux go build -ldflags="-s -w" -o /app/media-streaming ./cmd/media-streaming

# --- Final Stage ---
FROM alpine:3.19
WORKDIR /media-streaming
COPY --from=builder /app/media-streaming /media-streaming/
# Copy curl from the builder stage for health checks
COPY --from=builder /usr/bin/curl /usr/bin/curl
CMD ["/media-streaming/media-streaming"]